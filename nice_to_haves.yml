---
- hosts: all
  gather_facts: no
  sudo: yes
  sudo_user: "{{ANSIBLE_SSH_USER}}"

  vars_files:
    - ./vars/base.yml

  tasks:

    - name: download popcorntime io
      get_url: >
        url=http://mirror11.ptn.sh/build/Popcorn-Time-0.3.8-5-Linux-64.tar.xz
        dest=/tmp

    - name: create popcorntime extract directory
      shell: mkdir -p poptime chdir=/tmp

    - name: untar popcorntime
      shell: tar -xJf Popcorn-Time-0.3.8-5-Linux-64.tar.xz --directory=/tmp/poptime chdir=/tmp

    - name: configure custom install popcorntime script(we dont like prompts. do we?)
      template: src=templates/install_popcorntime.sh.j2
                dest=/tmp/poptime/install_popcorntime.sh
      ignore_errors: yes

    - name: install popcorntime
      shell: bash install_popcorntime.sh chdir=/tmp/poptime
      ignore_errors: yes

    - name: check if atom editor is already downloaded
      stat: path=/tmp/atom-amd64.deb
      register: atom_file_exist
      tags: 
        - atom

    - name: download atom editor
      shell: sudo wget --directory-prefix=/tmp https://github.com/atom/atom/releases/download/{{ATOM_EDITOR_VERSION}}/atom-amd64.deb
      when: atom_file_exist.stat.exists == False
      tags: 
        - atom

    - name: install atom editor
      shell: sudo dpkg -i /tmp/atom-amd64.deb
      tags: 
        - atom

    - name: configure atom/config.cson
      template: src=templates/atom.config.cson.j2
                dest=~/.atom/config.cson
      tags: 
        - atom
